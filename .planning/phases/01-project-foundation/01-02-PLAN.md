---
phase: 01-project-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - Makefile
  - scripts/hooks/pre-commit
  - scripts/hooks/commit-msg
  - .github/workflows/ci.yml
autonomous: true

must_haves:
  truths:
    - "`make check` runs lint + type + test and all pass"
    - "`make bootstrap` installs deps and git hooks"
    - "Pre-commit hook rejects a commit with lint violation"
    - "Commit-msg hook rejects non-conventional commit message"
    - "CI workflow would run make check + uv build on PRs and main pushes"
  artifacts:
    - path: "Makefile"
      provides: "Build automation with bootstrap, lint, format, type, test, check, clean targets"
      contains: "check: lint type test"
    - path: "scripts/hooks/pre-commit"
      provides: "Git pre-commit hook calling make check"
      contains: "make check"
    - path: "scripts/hooks/commit-msg"
      provides: "Conventional commit message enforcement"
      contains: "feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert"
    - path: ".github/workflows/ci.yml"
      provides: "GitHub Actions CI pipeline"
      contains: "make check"
  key_links:
    - from: "Makefile"
      to: "pyproject.toml"
      via: "uv run commands read tool config from pyproject.toml"
      pattern: "uv run (ruff|mypy|pytest)"
    - from: "scripts/hooks/pre-commit"
      to: "Makefile"
      via: "hook calls make check"
      pattern: "make check"
    - from: ".github/workflows/ci.yml"
      to: "Makefile"
      via: "CI step calls make check"
      pattern: "make check"
    - from: "Makefile"
      to: ".git/hooks/"
      via: "bootstrap copies hook scripts to .git/hooks/"
      pattern: "cp scripts/hooks"
---

<objective>
Create the Makefile (single source of truth for quality gates), git hook scripts (pre-commit + commit-msg), CI pipeline, and verify the complete quality toolchain works end-to-end.

Purpose: This completes the development workflow — both local hooks and CI use `make check`, ensuring zero drift. After this plan, every commit is quality-gated and every PR is CI-validated.
Output: Working Makefile, installed git hooks, CI workflow file, and verified end-to-end quality pipeline.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-project-foundation/01-RESEARCH.md
@.planning/phases/01-project-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Makefile and git hook scripts, run make bootstrap</name>
  <files>
    Makefile
    scripts/hooks/pre-commit
    scripts/hooks/commit-msg
  </files>
  <action>
    Create the Makefile and hook scripts using the EXACT configurations from 01-RESEARCH.md Q2, Q3, Q4.

    **Makefile** — Targets:
    - `.DEFAULT_GOAL := check`
    - `bootstrap`: `uv sync --dev`, then copy `scripts/hooks/pre-commit` and `scripts/hooks/commit-msg` to `.git/hooks/`, `chmod +x` both. Print "Done! Git hooks installed."
    - `lint`: `uv run ruff check .` then `uv run ruff format --check .`
    - `format`: `uv run ruff check --fix .` then `uv run ruff format .`
    - `type`: `uv run mypy src`
    - `test`: `uv run pytest`
    - `check`: depends on `lint type test` (runs all three — this is THE quality gate)
    - `clean`: remove dist/, build/, *.egg-info, .mypy_cache, .pytest_cache, .coverage, htmlcov/, .ruff_cache
    - All targets declared `.PHONY`
    - Use TABS for indentation (Makefile requirement — NOT spaces)

    **scripts/hooks/pre-commit** — Bash script:
    - `#!/usr/bin/env bash`
    - `set -e`
    - Print "Running pre-commit checks..."
    - Run `make check`
    - Print "All checks passed!"

    **scripts/hooks/commit-msg** — Bash script:
    - `#!/usr/bin/env bash`
    - `set -e`
    - Read first line of commit message from `$1`
    - Regex pattern: `^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-zA-Z0-9_-]+\))?: .{1,}`
    - If no match: print helpful error with expected format, types, examples, and the actual message. Exit 1.

    After creating files, run `make bootstrap` to install deps and hooks.
    Then run `make check` to verify the full pipeline (lint + type + test).

    AVOID:
    - Do NOT use spaces for Makefile indentation — MUST be tabs
    - Do NOT use `pre-commit` framework — simple git hooks per user decision
    - Do NOT use `uv sync --locked` in bootstrap — lockfile may not exist on first run
    - Do NOT use `source .venv/bin/activate` in recipes — use `uv run`
  </action>
  <verify>
    1. `make bootstrap` completes without errors, prints "Done! Git hooks installed."
    2. `.git/hooks/pre-commit` exists and is executable
    3. `.git/hooks/commit-msg` exists and is executable
    4. `make check` passes (lint + type + test all green)
    5. `make lint` passes independently
    6. `make type` passes independently
    7. `make test` passes independently
  </verify>
  <done>
    Makefile exists with all 7 targets. Git hooks installed in .git/hooks/. `make check` runs lint + type + test and all pass. `make bootstrap` works from clean state.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CI workflow and validate full build pipeline</name>
  <files>
    .github/workflows/ci.yml
  </files>
  <action>
    Create the GitHub Actions CI workflow using the EXACT configuration from 01-RESEARCH.md Q10.

    **.github/workflows/ci.yml** — Workflow:
    - `name: CI`
    - Triggers: `pull_request` (all branches) and `push` to `main` branch
    - Single job: `check` on `ubuntu-latest`
    - Steps:
      1. `actions/checkout@v6` with `fetch-depth: 0` (CRITICAL: full history for dynamic versioning from git tags)
      2. `astral-sh/setup-uv@v7` with `version: "0.10.0"` and `enable-cache: true`
      3. `uv python install 3.13`
      4. `uv sync --dev`
      5. `make check` (name: "Check (lint + type + test)")
      6. `uv build` (name: "Build")

    Key details:
    - Python 3.13 ONLY — no matrix (requires-python >= 3.13 makes 3.11/3.12 impossible, per research)
    - `fetch-depth: 0` is REQUIRED for uv-dynamic-versioning to read git tags
    - `enable-cache: true` handles UV cache automatically
    - `make check` in CI = same as local hooks = single source of truth, no drift

    After creating the workflow file, validate the complete build pipeline locally:
    1. Run `make clean` to clear artifacts
    2. Run `make check` to verify all quality gates pass
    3. Run `uv build` to verify wheel builds
    4. Verify the wheel contains the package: `unzip -l dist/*.whl` should show `data_architect/` files
    5. Test install in isolated environment: `uv run --isolated --with ./dist/*.whl python -c "import data_architect; print(data_architect.__version__)"`

    AVOID:
    - Do NOT add a Python version matrix — 3.13 only per research finding
    - Do NOT add CD/publish steps — deferred to Milestone 2 per user decision
    - Do NOT add multi-OS testing — deferred per user decision
    - Do NOT add coverage reporting to Codecov — deferred per user decision
  </action>
  <verify>
    1. `.github/workflows/ci.yml` exists with correct triggers, steps, and configuration
    2. `make clean && make check` passes from clean state
    3. `uv build` produces dist/*.whl and dist/*.tar.gz
    4. Wheel contains data_architect package files (verify with unzip -l)
    5. `uv run --isolated --with ./dist/*.whl python -c "import data_architect; print(data_architect.__version__)"` prints a version string
  </verify>
  <done>
    CI workflow file exists and correctly configured. Full local pipeline validated: lint + type + test pass, wheel builds, wheel installs and is importable. Phase 1 foundation is complete.
  </done>
</task>

</tasks>

<verification>
Phase 1 success criteria verification:
1. `uv build` produces a wheel → `pip install` from wheel works in isolated env
2. `make check` runs lint + type-check + test → all three pass with zero warnings
3. Git hooks installed → pre-commit runs `make check`, commit-msg enforces conventional commits
4. CI workflow exists → triggers on PRs + main, runs `make check` + `uv build`
5. Version from git tags → `grep -r '__version__.*=' src/` shows only importlib.metadata pattern, no hardcoded string
</verification>

<success_criteria>
1. Makefile has all targets: bootstrap, lint, format, type, test, check, clean
2. `make check` = lint + type + test, all pass
3. Git hooks in .git/hooks/ are executable and functional
4. .github/workflows/ci.yml triggers on PRs + main, runs make check + uv build
5. Wheel builds and installs correctly in isolated environment
6. No deferred items included (no CD pipeline, no multi-OS, no Codecov)
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-foundation/01-02-SUMMARY.md`
</output>
